<?xml version="1.0" encoding="UTF-8"?>
<section>
  <title>Interactive Console Command Line Operation</title>
  <para>
      This section serves to document the basic methods of operation
      available through the interactive console's command line interface.  
      It is currently in rough draft status.
  </para>

  <section>
    <title>General Operational Principles</title>
    <para>
      The command line interface to the system available through the 
      interactive console operates in a fashion similar to Cisco's <trademark>IOS</trademark>, 
      in that there are various "levels" or "sets"/"sub-sets" of commands 
      within the interface.  Operations and operands may be tab-completed 
      or abbreviated to their un-ambiguous form as needed or desired 
      (analogous to "configure terminal" becoming "conf t" in common IOS 
      usage).
    </para>
  </section>

  <section>
    <title>Accessing the Interactive Console</title>
    <para>
      The interactive console is accessed by telneting to the configured
      access port on the host running <command>noitd</command>.  By default this is
      port 32322.  The applicable configuration parameter in the <command>noitd.conf</command>
      XML file is the port attribute of the "listener" element, e.g.:
      <programlisting><![CDATA[
      <listener address="*" port="32322">
        ]]></programlisting> Please see the configuration section of
      the manual for more information.
    </para>
  </section>

  <section>
    <title>Basic Command List</title>
    <para>An example session of interaction showing the use of help and a few 
      operating modes is illustrative:
      <screen>
      noit# help
      = Topics =
      ==&gt; 'module'

      = Commands =
      ==&gt; 'apply'
      ==&gt; 'configure'
      ==&gt; 'exit'
      ==&gt; 'no'
      ==&gt; 'reload'
      ==&gt; 'restart'
      ==&gt; 'show'
      ==&gt; 'shutdown'
      ==&gt; 'watch'
      ==&gt; 'write'
      noit# help module
      Help for 'module':
      = Loaders and Modules =
      lua
      ping_icmp
      smtp
      ssh2
      varnish
      selfcheck
      resmon
      http
      snmp
      noit# configure {tab pressed twice}
      apply     help      terminal
      noit# conf t
      noit(conf:/)# ls
      == Section Settings ==
      @lockfile: /var/run/noitd.lock
      == Subsections ==
      eventer
      logs
      modules
      listeners
      rest
      checks
      filtersets
      config_templates
      noit(conf:/)# help
      -&gt; 'terminal'
      = Topics =
      ==&gt; 'module'

      = Commands =
      ==&gt; 'apply'
      ==&gt; 'attribute'
      ==&gt; 'cd'
      ==&gt; 'check'
      ==&gt; 'config'
      ==&gt; 'exit'
      ==&gt; 'filterset'
      ==&gt; 'ls'
      ==&gt; 'no'
      ==&gt; 'section'
      ==&gt; 'write'
      noit(conf:/)# exit
      noit# show
      ==&gt; 'apply'
      ==&gt; 'check'
      ==&gt; 'checks'
      ==&gt; 'eventer'
      ==&gt; 'watches'
      incomplete command.

      </screen>

      <variablelist>
        <title>Command Descriptions</title>

        <varlistentry>
          <term>help</term>
          <listitem>
            <para><command>help</command> provides brief help information appropriate to a given context.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>show</term>
          <listitem>
            <para><command>show</command> shows various aspects of the system.  See the "Showing System Information" section below for further detail.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>watch</term>
          <listitem>
            <para><command>watch</command> is much like show except it re-displays the given information periodically.  See the "Showing System Information" section below for further detail.</para>
          </listitem>
        </varlistentry>
        
        <varlistentry>
          <term>exit</term>
          <listitem>
            <para><command>exit</command> leaves the current "level" of session (e.g. returns to regular interactive session if used within a configuration sub-"level" or exits the current interactive session entirely and closes the connection if used within the regular interaction "level").</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>configure</term>
          <listitem>
            <para><command>configure</command> causes the session to enter configuration mode if used with the <command>terminal</command> argument or FIXME: does something with apply, not sure what.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>write</term>
          <listitem>
            <para><command>write</command> writes the current operating configuration to: the permanent configuration store (<command>noitd.conf</command> by default, in the location specified either at startup with -c or in the default compile-time system directory) with <command>file</command> argument (<command>memory</command> is an alias), or to the current interactive display with the <command>terminal</command> argument.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>reload</term>
          <listitem>
            <para><command>reload</command> causes <command>noitd</command> to reload configuration information from the permanent configuration store (<command>noitd.conf</command> by default, in the location specified either at startup with -c or in the default compile-time system directory).</para>
          </listitem>
        </varlistentry>

        <varlistentry>
            <term>restart</term>
            <listitem>
              <para><command>restart</command> causes <command>noitd</command> to restart, re-reading all configuration from the permanent configuration store in the process. As part of restarting, the current interactive session is terminated.</para>
            </listitem>
        </varlistentry>

        <varlistentry>
            <term>shutdown</term>
            <listitem>
              <para><command>shutdown</command> causes <command>noitd</command> to shut down entirely.</para>
            </listitem>
        </varlistentry>

      </variablelist>
    </para>
  </section>

  <section>
    <title>Showing System Information</title>
    <para>The two main commands for showing system information are <command>show</command> and <command>watch</command>.  <command>show</command> is useful for one-off queries of information, and <command>watch</command> is useful for periodically redisplaying the same information (e.g. to see snapshots of activity while some other process is affecting the monitored system/information).</para>
    <section>
      <title>show</title>
      <para><command>show</command> show accepts a number of arguments:</para>
      <variablelist>
        <varlistentry>
          <term>watches</term>
          <listitem>
            <para><command>show watches</command> displays a list of all active watches currently being serviced by <command>noitd</command>.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>checks</term>
          <listitem>
            <para><command>show checks</command> displays a list of checks that <command>noitd</command> is currently servicing.  Example output is illuminative:</para>
              <screen>
                noit# show checks
                1b4e28ba-2fa1-11d2-883f-b9b761bde3fb 127.0.0.1`ping_icmp
                cnt=5,avail=100,min=0.0000,max=0.0000,avg=0.0000
                f7cea020-f19d-11dd-85a6-cb6d3a2207dc 127.0.0.1`selfcheck
                ok
                002d58ff-20ff-4db0-9420-782fc1748dc4 127.0.0.1`ssh2
                59698f91c167393deb952564fe316dca
              </screen>
              <para>Each check's primary identifier is a hexadecimal GUID.  This may be tab-completed in common use from the longest unique string, much like commands. In the example above, for instance, "002" would be sufficient to tab complete a reference to the check 002d58ff-20ff-4db0-9420-782fc1748dc4. Each check is further identified as accessing a given IP/host and contains some description of what the check is doing as configured when the check was configured (see the "Configuring the System" section below, and/or <command>noitd.conf</command>). The second line for each check provides check-specific further information or status.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>check</term>
          <listitem>
            <para><command>show check {check id}</command>. See discussion above for referencing a particular check by id.  This provides more in-depth information about a specific check.  For example, using the check list mentioned above:</para>
              <screen>
                noit# show check 1b4e28ba-2fa1-11d2-883f-b9b761bde3fb
                ==== 1b4e28ba-2fa1-11d2-883f-b9b761bde3fb ====
                name: ping_icmp [from module]
                module: ping_icmp
                target: 127.0.0.1
                period: 15000
                timeout: 14000
                oncheck: [undef]
                filterset: default [inherited from @filterset]
                disable: [undef]
                currently: running
                last run: 9.377 seconds ago
                availability/state: available/good
                status: cnt=5,avail=100,min=0.0000,max=0.0001,avg=0.0000
                metrics:
                available[n] = 1.000000000000e+02
                *count[i] = 5
                average[n] = 4.359999984445e-05
                *maximum[n] = 5.400000009104e-05
                *minimum[n] = 2.800000038405e-05
              </screen>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>

    <section>
      <title>watch</title>
    </section>
    <para>FIXME text...</para>
  </section>
      
</section>
<!--
vim:ts=2:sw=2:et:
-->
